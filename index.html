<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>KB HUATES</title>

    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta
      name="apple-mobile-web-app-status-bar-style"
      content="black-translucent"
    />
    <meta name="theme-color" content="#0a0a0a" />
    <link rel="apple-touch-icon" href="KBHUATES.png" />

    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;900&display=swap");

      body {
        font-family: "Outfit", sans-serif;
        background-color: #0a0a0a;
        color: #ffffff;
        -webkit-tap-highlight-color: transparent;
        overflow-x: hidden;
      }

      .glass-card {
        background: rgba(255, 255, 255, 0.03);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.05);
        transition: transform 0.2s ease;
      }

      .btn-primary {
        background: #f97316;
        box-shadow: 0 10px 30px -10px rgba(249, 115, 22, 0.5);
      }

      .footer-blur {
        background: rgba(10, 10, 10, 0.8);
        backdrop-filter: blur(20px);
        border-top: 1px solid rgba(255, 255, 255, 0.05);
      }

      .mute-btn {
        position: fixed;
        top: env(safe-area-inset-top, 20px);
        right: 20px;
        z-index: 100;
        background: rgba(255, 255, 255, 0.05);
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 14px;
      }

      @keyframes pulse-slow {
        0%,
        100% {
          opacity: 0.3;
          transform: scale(0.98);
        }
        50% {
          opacity: 0.6;
          transform: scale(1);
        }
      }
      .animate-pulse-slow {
        animation: pulse-slow 3s infinite ease-in-out;
      }

      input::placeholder,
      textarea::placeholder {
        color: rgba(255, 255, 255, 0.3);
      }
    </style>
  </head>

  <body class="pb-44">
    <div
      id="loading-screen"
      class="fixed inset-0 z-[9999] flex flex-col items-center justify-center bg-[#0a0a0a]"
    >
      <div class="relative">
        <svg class="w-40 h-40 transform -rotate-90">
          <circle
            cx="80"
            cy="80"
            r="70"
            stroke="currentColor"
            stroke-width="1.5"
            fill="transparent"
            class="text-white/5"
          />
          <circle
            id="progress-circle"
            cx="80"
            cy="80"
            r="70"
            stroke="currentColor"
            stroke-width="1.5"
            fill="transparent"
            stroke-dasharray="440"
            stroke-dashoffset="440"
            class="text-orange-500 transition-all duration-300 ease-out"
          />
        </svg>
        <div class="absolute inset-0 flex items-center justify-center">
          <img
            src="KBHUATES.png"
            class="w-20 h-20 rounded-full animate-pulse-slow opacity-80"
          />
        </div>
      </div>
      <div class="mt-10 text-center">
        <h2
          class="text-xs font-light tracking-[0.8em] text-white uppercase opacity-40 mb-3"
        >
          KB HUATES
        </h2>
        <div class="h-4 overflow-hidden">
          <p
            id="loading-text"
            class="text-[10px] font-bold text-orange-500 tracking-[0.3em] uppercase"
          >
            Initializing
          </p>
        </div>
      </div>
    </div>

    <audio id="bgMusic" loop>
      <source src="musica.mp3" type="audio/mpeg" />
    </audio>

    <button class="mute-btn" id="muteBtn">üîä</button>

    <header class="p-8 pt-12 flex items-center justify-between">
      <div class="flex items-center gap-5">
        <div class="w-12 h-12 rounded-full border border-white/10 p-1">
          <img
            src="KBHUATES.png"
            alt="KB"
            class="w-full h-full object-cover rounded-full"
          />
        </div>
        <div>
          <h1 class="text-xl font-bold tracking-tight text-white uppercase">
            KB HUATES
          </h1>
          <p
            class="text-[10px] text-orange-500 font-bold tracking-widest uppercase opacity-80"
          >
            Los mejores de la laguna
          </p>
        </div>
      </div>
      <div
        class="flex items-center gap-2 bg-white/5 px-3 py-1.5 rounded-full border border-white/10"
      >
        <div class="w-1.5 h-1.5 bg-green-500 rounded-full animate-pulse"></div>
        <span
          class="text-[9px] font-bold uppercase tracking-widest text-white/60"
          >En l√≠nea</span
        >
      </div>
    </header>

    <main class="px-6 space-y-6">
      <h2
        class="text-[11px] font-bold uppercase tracking-[0.3em] text-white/30 ml-2"
      >
        Selecciona tu antojo
      </h2>

      <div class="space-y-3">
        <div
          class="glass-card p-5 rounded-[2rem] flex items-center justify-between"
        >
          <div class="flex items-center gap-5">
            <span class="text-3xl">üå∂Ô∏è</span>
            <div>
              <h3 class="font-bold text-lg leading-tight text-white">
                Jalape√±o
              </h3>
              <p class="text-xs text-white/40">$13.00 c/u</p>
            </div>
          </div>
          <div class="flex items-center gap-4 bg-black/40 p-1 rounded-2xl">
            <button
              onclick="changeQty('jalapeno', -1, 13)"
              class="w-10 h-10 text-xl font-light opacity-50"
            >
              -
            </button>
            <span id="qty-jalapeno" class="font-bold text-lg w-4 text-center"
              >0</span
            >
            <button
              onclick="changeQty('jalapeno', 1, 13)"
              class="w-10 h-10 text-xl font-bold text-orange-500"
            >
              +
            </button>
          </div>
        </div>

        <div
          class="glass-card p-5 rounded-[2rem] flex items-center justify-between"
        >
          <div class="flex items-center gap-5">
            <span class="text-3xl">üßÄ</span>
            <div>
              <h3 class="font-bold text-lg leading-tight text-white">Queso</h3>
              <p class="text-xs text-white/40">$13.00 c/u</p>
            </div>
          </div>
          <div class="flex items-center gap-4 bg-black/40 p-1 rounded-2xl">
            <button
              onclick="changeQty('queso', -1, 13)"
              class="w-10 h-10 text-xl font-light opacity-50"
            >
              -
            </button>
            <span id="qty-queso" class="font-bold text-lg w-4 text-center"
              >0</span
            >
            <button
              onclick="changeQty('queso', 1, 13)"
              class="w-10 h-10 text-xl font-bold text-orange-500"
            >
              +
            </button>
          </div>
        </div>

        <div
          class="glass-card p-5 rounded-[2rem] flex items-center justify-between"
        >
          <div class="flex items-center gap-5">
            <span class="text-3xl">‚ö°</span>
            <div>
              <h3 class="font-bold text-lg leading-tight text-white">Takis</h3>
              <p class="text-xs text-white/40">$13.00 c/u</p>
            </div>
          </div>
          <div class="flex items-center gap-4 bg-black/40 p-1 rounded-2xl">
            <button
              onclick="changeQty('takis', -1, 13)"
              class="w-10 h-10 text-xl font-light opacity-50"
            >
              -
            </button>
            <span id="qty-takis" class="font-bold text-lg w-4 text-center"
              >0</span
            >
            <button
              onclick="changeQty('takis', 1, 13)"
              class="w-10 h-10 text-xl font-bold text-orange-500"
            >
              +
            </button>
          </div>
        </div>
      </div>

      <div class="pt-4">
        <textarea
          id="location"
          placeholder="üìç Instrucciones de entrega o ubicaci√≥n..."
          class="w-full p-6 rounded-[2rem] glass-card text-white text-sm outline-none focus:border-orange-500/50 h-28 transition-all resize-none font-medium"
        ></textarea>
      </div>

      <div class="glass-card p-6 rounded-[2rem] space-y-4">
        <p
          class="text-[9px] font-bold text-white/30 uppercase tracking-[0.2em]"
        >
          Transferencia Express
        </p>
        <div class="flex justify-between items-center">
          <p class="font-bold text-sm tracking-widest text-white/80">
            728969000134231676
          </p>
          <button
            onclick="copyClabe(this)"
            class="text-[10px] font-bold text-orange-500 uppercase px-4 py-2 bg-orange-500/10 rounded-full"
          >
            Copiar
          </button>
        </div>
      </div>

      <footer class="pt-10 pb-10 text-center">
        <p
          class="text-[10px] text-white/20 font-medium tracking-[0.2em] uppercase"
        >
          Desarrollado por Sebastian Salinas
        </p>
      </footer>
    </main>

    <footer class="fixed bottom-0 left-0 w-full p-8 pb-10 footer-blur z-50">
      <div class="flex justify-between items-center mb-6 px-2">
        <div>
          <p
            class="text-[10px] font-bold uppercase text-white/30 tracking-widest mb-1"
          >
            Inversi√≥n Total
          </p>
          <span id="total-price" class="text-3xl font-bold text-white"
            >$0.00</span
          >
        </div>
        <div class="text-right">
          <span
            id="total-items"
            class="text-[10px] font-black border border-white/10 px-4 py-2 rounded-full uppercase text-white/60"
            >0 Unidades</span
          >
        </div>
      </div>
      <button
        onclick="sendOrder()"
        class="w-full btn-primary py-5 rounded-3xl text-black text-sm font-black uppercase tracking-[0.2em] active:scale-95 transition-all"
      >
        Confirmar Orden üöÄ
      </button>
    </footer>

    <script>
      // LOGICA DE CARGA
      window.addEventListener("load", () => {
        const circle = document.getElementById("progress-circle");
        const textStatus = document.getElementById("loading-text");
        const messages = ["Analyzing", "Syncing", "Ready"];
        let progress = 0;
        const circumference = 440;

        const updateLoading = setInterval(() => {
          progress += Math.random() * 12;
          if (progress >= 100) {
            progress = 100;
            clearInterval(updateLoading);
            textStatus.innerText = "Welcome";
            setTimeout(() => {
              const screen = document.getElementById("loading-screen");
              screen.style.transition = "all 1s cubic-bezier(0.65, 0, 0.35, 1)";
              screen.style.opacity = "0";
              screen.style.filter = "blur(30px)";
              setTimeout(() => screen.remove(), 1000);
            }, 500);
          }
          const offset = circumference - (progress / 100) * circumference;
          circle.style.strokeDashoffset = offset;
          if (progress > 30 && progress < 60)
            textStatus.innerText = messages[0];
          if (progress > 60 && progress < 90)
            textStatus.innerText = messages[1];
          if (progress > 90) textStatus.innerText = messages[2];
        }, 150);
      });

      // L√ìGICA DE NEGOCIO
      let cart = { jalapeno: 0, queso: 0, takis: 0 };
      let total = 0;
      let musicStarted = false;
      const audio = document.getElementById("bgMusic");
      const muteBtn = document.getElementById("muteBtn");

      // Cargar ubicaci√≥n guardada
      document.addEventListener("DOMContentLoaded", () => {
        const savedLoc = localStorage.getItem("kb_location");
        if (savedLoc) document.getElementById("location").value = savedLoc;
      });

      function changeQty(flavor, delta, price) {
        if (cart[flavor] + delta >= 0) {
          cart[flavor] += delta;
          total += delta * price;
          document.getElementById(`qty-${flavor}`).innerText = cart[flavor];
          document.getElementById("total-price").innerText =
            `$${total.toFixed(2)}`;
          document.getElementById("total-items").innerText =
            `${cart.jalapeno + cart.queso + cart.takis} Unidades`;
          if (navigator.vibrate) navigator.vibrate(40);
        }
      }

      function copyClabe(btn) {
        navigator.clipboard.writeText("728969000134231676");
        const originalText = btn.innerText;
        btn.innerText = "¬°COPIADO!";
        btn.classList.add("text-green-500");
        setTimeout(() => {
          btn.innerText = originalText;
          btn.classList.remove("text-green-500");
        }, 2000);
      }

      // --- ENV√çO DIRECTO A LA BASE DE DATOS LOCAL ---
      async function sendOrder() {
        const loc = document.getElementById("location").value;
        if (total === 0) return alert("Elige tus munchies primero ü•ú");
        if (!loc) return alert("Dime d√≥nde entregamos üìç");

        const items = [];
        if (cart.jalapeno > 0) items.push(`${cart.jalapeno} Jalape√±o`);
        if (cart.queso > 0) items.push(`${cart.queso} Queso`);
        if (cart.takis > 0) items.push(`${cart.takis} Takis`);
        const detallePedido = items.join(", ");

        try {
          const response = await fetch("/guardar-pedido", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              detalle: detallePedido,
              total: total,
              ubicacion: loc,
            }),
          });

          if (response.ok) {
            localStorage.setItem("kb_location", loc);
            alert("üöÄ ¬°Orden enviada con √©xito! La llevaremos pronto.");

            // Reiniciar Aplicaci√≥n
            cart = { jalapeno: 0, queso: 0, takis: 0 };
            total = 0;
            document.getElementById("qty-jalapeno").innerText = "0";
            document.getElementById("qty-queso").innerText = "0";
            document.getElementById("qty-takis").innerText = "0";
            document.getElementById("total-price").innerText = "$0.00";
            document.getElementById("total-items").innerText = "0 Unidades";
          } else {
            alert("‚ùå Error al procesar el pedido.");
          }
        } catch (error) {
          alert("‚ùå Error de conexi√≥n. Revisa que el servidor est√© prendido.");
        }
      }

      // Audio Control
      document.addEventListener("click", () => {
        if (!musicStarted) {
          audio.volume = 0.2;
          audio.play().catch(() => {});
          musicStarted = true;
        }
      });

      muteBtn.addEventListener("click", (e) => {
        e.stopPropagation();
        audio.muted = !audio.muted;
        muteBtn.innerText = audio.muted ? "üîá" : "üîä";
      });
    </script>
  </body>
</html>
